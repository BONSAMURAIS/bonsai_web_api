<!doctype html>
<html>
<title>{% block title %}{% endblock %} - Bonsai Web Interface</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
<link rel="icon" href="https://bonsai.uno/wp-content/themes/bonsai/favicon.ico">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
<script src="{{ url_for('static', filename='js/popper.min.js') }}"></script>   
<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>


<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="{{ url_for('web_app.index') }}">
    <svg class="site-nav__logo" height="39" viewBox="0 0 414 100" shape-rendering="geometricPrecision" >
              <path d="M36.1209029,53.8968874 C37.4299125,54.2107947 38.714374,54.7200662 39.9709702,55.4260265 C41.2282298,56.1319868 42.354124,57.0213907 43.3493163,58.0929139 C44.3445087,59.1650993 45.1300471,60.4061589 45.7072587,61.8180795 C46.2831433,63.2293377 46.5710856,64.7982119 46.5710856,66.5240397 C46.5710856,69.5564901 45.9553933,72.1054967 44.7246721,74.1703974 C43.4932875,76.2366225 41.8691337,77.9094702 39.8535375,79.1896026 C37.8366144,80.4717219 35.531749,81.3856291 32.9389413,81.9346358 C30.3461337,82.4836424 27.6869798,82.7584768 24.9641337,82.7584768 L-0.257356731,82.7584768 L-0.257356731,27.2313245 L22.6075183,27.2313245 C24.8586433,27.2313245 27.2550663,27.4021854 29.796124,27.7412583 C32.3365183,28.0823179 34.6798644,28.7611258 36.8281529,29.7803311 C38.9757779,30.7995364 40.7571721,32.2896026 42.1710087,34.2505298 C43.5855087,36.211457 44.2927587,38.7869536 44.2927587,41.9756954 C44.2927587,44.9558278 43.5463644,47.414106 42.0529125,49.3478808 C40.5607875,51.2829801 38.5830087,52.7207285 36.1209029,53.6617881 L36.1209029,53.8968874 Z M17.1857106,60.5631126 L17.1857106,68.0922517 L22.7640952,68.0922517 C24.2296817,68.0922517 25.4219221,67.7664238 26.338826,67.1121192 C27.2550663,66.4591391 27.7141817,65.5041722 27.7141817,64.2492053 C27.7141817,63.5174172 27.5177971,62.9160927 27.1243644,62.4452318 C26.7315952,61.9750331 26.2466048,61.5962252 25.6713837,61.3081457 C25.0941721,61.0213907 24.4791433,60.8253642 23.8249702,60.7200662 C23.1694702,60.6160927 22.5544413,60.5631126 21.9785567,60.5631126 L17.1857106,60.5631126 Z M17.1857106,41.740596 L17.1857106,48.5637748 L22.2140856,48.5637748 C23.5230952,48.5637748 24.5972394,48.2631126 25.4351913,47.6617881 C26.2724798,47.0611258 26.692451,46.132649 26.692451,44.8776821 C26.692451,43.832649 26.2466048,43.048543 25.3569029,42.524702 C24.465874,42.0028477 23.2869029,41.740596 21.8213163,41.740596 L17.1857106,41.740596 Z M162.226497,27.2313245 L180.847872,27.2313245 L196.719199,55.3869536 L197.03368,55.3869536 L196.248141,27.2313245 L214.005026,27.2313245 L214.005026,82.7584768 L194.912593,82.7584768 L179.512324,56.2498675 L179.197843,56.2498675 L179.983382,82.7584768 L162.226497,82.7584768 L162.226497,27.2313245 Z M329.187655,27.2315232 L349.066289,27.2315232 L370.752857,82.7580132 L350.402501,82.7580132 L347.495213,74.6017219 L329.816616,74.6017219 L327.066568,82.7580132 L307.266222,82.7580132 L329.187655,27.2315232 Z M338.852299,46.6030464 L334.294318,60.3282119 L343.330001,60.3282119 L338.852299,46.6030464 Z M395.108596,27.2311258 L413.9655,27.2311258 L413.9655,82.7582781 L395.108596,82.7582781 L395.108596,27.2311258 Z M256.392854,83.7425828 C254.21869,83.3511921 252.124142,82.7790066 250.107219,82.0253642 C248.090296,81.2703974 246.190806,80.3869536 244.410738,79.3723841 C242.629344,78.3578146 241.032392,77.2266887 239.618556,75.9776821 L251.011517,63.6213907 C252.319863,65.0333113 254.062113,66.2882781 256.235613,67.3862914 C258.409113,68.4843046 260.648296,69.0333113 262.954488,69.0333113 C264.000767,69.0333113 264.957479,68.8511921 265.821969,68.4829801 C266.685796,68.116755 267.11771,67.435298 267.11771,66.440596 C267.11771,65.9174172 266.972412,65.4723841 266.685796,65.1048344 C266.39719,64.737947 265.886988,64.3584768 265.153863,63.9664238 C264.420075,63.5743709 263.411613,63.1412583 262.128479,62.6697351 C260.844017,62.1995364 259.233796,61.6492053 257.296488,61.0187417 C255.411594,60.3915894 253.603662,59.6452318 251.875344,58.7803311 C250.147027,57.9160927 248.614431,56.8551656 247.278883,55.5975497 C245.942671,54.340596 244.883123,52.835298 244.097585,51.0809934 C243.311383,49.3260265 242.91795,47.2180795 242.91795,44.7551656 C242.91795,41.2995364 243.6252,38.3657616 245.0397,35.9564901 C246.4542,33.5472185 248.273412,31.5690728 250.500652,30.0240397 C252.725902,28.4790066 255.226488,27.3664238 258.003738,26.6849669 C260.778998,26.0035099 263.52971,25.6631126 266.253883,25.6631126 C269.920171,25.6631126 273.651479,26.3690728 277.449796,27.7803311 C281.24745,29.1922517 284.587315,31.2313245 287.468065,33.8982119 L275.840238,45.740596 C274.582315,44.1717219 273.037113,42.9836424 271.203969,42.1717219 C269.369498,41.3617881 267.720133,40.9564901 266.253883,40.9564901 C264.891133,40.9564901 263.791113,41.1525166 262.954488,41.5445695 C262.11521,41.9366225 261.696565,42.5776821 261.696565,43.4664238 C261.696565,44.3028477 262.128479,44.9306623 262.992969,45.348543 C263.856796,45.7670861 265.258027,46.2896026 267.195998,46.916755 C269.186383,47.5439073 271.282921,48.2770199 273.482296,49.1127815 C275.682335,49.9498675 277.7112,51.0346358 279.571546,52.3677483 C281.430565,53.7008609 282.962498,55.335298 284.168671,57.2690728 C285.372854,59.2041722 285.974613,61.6094702 285.974613,64.4843046 C285.974613,67.8313245 285.307835,70.7465563 283.971623,73.2293377 C282.635412,75.7134437 280.880556,77.7783444 278.707056,79.424702 C276.532892,81.0717219 274.083392,82.3015232 271.36121,83.111457 C268.636373,83.9213907 265.861113,84.3266887 263.032777,84.3266887 C260.778998,84.3266887 258.56569,84.1306623 256.392854,83.7425828 Z M74.5664423,88.4933775 L129.901125,88.4933775 L129.901125,99.994702 L74.5664423,99.994702 L74.5664423,88.4933775 Z M94.4871404,6.39490066 L88.0283423,-0.0534437086 L81.5682173,6.39357616 L73.6146404,14.3313245 L81.1177269,21.8227152 L88.0270154,14.927351 L94.9349769,21.8233775 L102.43939,14.3339735 L94.4871404,6.39490066 Z M130.473626,41.6582119 C128.902549,38.0774172 126.728386,35.0310596 123.952462,32.5217881 C121.175212,30.0118543 117.902357,28.0780795 114.131241,26.7178146 C110.359462,25.3588742 106.273866,24.6787417 101.873789,24.6787417 C97.4737125,24.6787417 93.3881163,25.3588742 89.617001,26.7178146 C85.8458856,28.0780795 82.5849721,30.0118543 79.834924,32.5217881 C77.084876,35.0310596 74.9239817,38.0774172 73.3529048,41.6582119 C71.7811644,45.2403311 70.995626,49.2535762 70.995626,53.6966225 C70.995626,58.1416556 71.7811644,62.1939735 73.3529048,65.8535762 C74.9239817,69.5131788 77.084876,72.6376821 79.834924,75.2250993 C82.5849721,77.8131788 85.8458856,79.8131788 89.617001,81.2250993 C93.3881163,82.6370199 97.4737125,83.3423179 101.873789,83.3423179 C106.273866,83.3423179 110.359462,82.6370199 114.131241,81.2250993 C117.902357,79.8131788 121.175212,77.8131788 123.952462,75.2250993 C126.728386,72.6376821 128.902549,69.5131788 130.473626,65.8535762 C132.044703,62.1939735 132.830905,58.1416556 132.830905,53.6966225 C132.830905,49.2535762 132.044703,45.2403311 130.473626,41.6582119 Z M118.103386,52.8436424 L111.195424,45.9469536 L104.286136,52.8423179 L97.1287125,45.6966225 L111.196751,31.6568874 L125.262136,45.6992715 L118.103386,52.8436424 Z M100.175328,70.4562252 L93.2673663,63.5601987 L86.3580779,70.4555629 L79.2006548,63.3098675 L93.2680298,49.2701325 L107.334078,63.3118543 L100.175328,70.4562252 Z"></path>
            </svg>
    <i><u>Web Interface</u></i>
  </a>
 
    <ul class="nav navbar-nav mx-auto">
        <form class="form-inline">
          <input class="form-control mr-sm-2" type="search" placeholder="Search for products" aria-label="Search" id="search_input" style="width:400px;">
            <a class="navbar-brand" href="#">by</a>
            <ul class="navbar-nav mr-auto">
                <select class="custom-select" id="search_type_select">
                    <option value="name" selected>Name</option>
                    <option value="uri">URI</option>
                </select>
            </ul>
             <a class="navbar-brand" href="#" style="margin-left:10px;" >limited to</a>
            <ul class="navbar-nav mr-auto">
                <select class="custom-select" id="search_lim_select">
                    <option value="10" selected>10</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </ul>
            <a class="navbar-brand" href="#" style="margin-left:10px;">results</a>

            <!--<button class="btn btn-outline-success my-2 my-sm-0" style="margin-left:20px;" type="submit">Search</button>-->
            <button class="btn btn-outline-warning my-2 my-sm-0" style="margin-left:20px;" type="submit">Calculate</button>
            <button type="button" class="btn btn-outline-danger" style="margin-left:20px;">Clear selection</button>
            <button type="button" class="btn btn-outline-success" style="margin-left:20px;">Contribute with data</button>
        </form>
    </ul>
    <div class="navbar-collapse collapse w-20 order-3 dual-collapse2">
        {% if g.user %}
            <ul class="navbar-nav ml-auto">
                <li class="nav-item" style="margin-right:10px;">
                    <span>{{ g.user['username'] }}</span>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('auth.logout') }}">Log Out</a>
                </li>
            </ul>
        {% else %}
            <ul class="navbar-nav ml-auto">
                <li class="nav-item" style="margin-right:10px;">
                     <a href="{{ url_for('auth.register') }}">Register</a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('auth.login') }}">Log In</a>
                </li>
            </ul>
        {% endif %}
    </div>
</nav>


<section class="content">
  <header>
    {% block header %}{% endblock %}
  </header>
  {% for message in get_flashed_messages() %}
    <div class="flash">{{ message }}</div>
  {% endfor %}
  {% block content %}{% endblock %}
</section>


 
<script>

     function add_row_to_table(btn){
            $("#div_calc_setup").show();
            var row_id = btn.id;
            $("#table_search_results tr").each(function() {
                if ($(this).find('td').eq(1).text() == row_id){
                    var tr = $(this).closest("tr").remove().clone();
                    tr.find('td').eq(2).html("<button class='btn btn-outline-danger my-2 my-sm-0' id='"+tr.find('td').eq(1).text()+"' onclick='remove_row_from_table(this)'>Yes</button>");
                    $("#table_products_calc tbody").append(tr);
                };

                });
        };
    


        

        $('#search_input').keyup(function() {


            var search_val = $(this).val();
            var search_type = $("#search_type_select").val();
            var search_lim = $("#search_lim_select").val()

            $.when($.ajax({
                url: "/rest/products/search_by_"+search_type+"/"+search_val,
                dataType: 'json',
                type: 'GET',
                success : function(data) {
                   var json = data
                    return json
                    },
                error: function(xhr, status, error){console.log(error)}})
            ).then(function(json){
                $("#table_search_results").find("tr:gt(0)").remove();
                for (var i = 0; i < json.length; i++) {
                    var newRowContent = "<tr><td><a id='popoverData' class='btn' href='/product_description/"+json[i]["uri"]+"' target='_blank' data-content="+json[i]["introduction"]+" rel='popover' data-placement='bottom' data-original-title="+json[i]["name"]+" data-trigger='hover' style='font-size:12px;'>"+json[i]["name"]+"</a></td><td>"+json[i]["uri"]+"</td><td><button class='btn btn-outline-success my-2 my-sm-0' id="+json[i]["uri"]+" onclick='add_row_to_table(this)'>Yes</button></td></tr>";
                    $("#table_search_results tbody").append(newRowContent);  
                    }
                $('#table_search_results a').popover();

            })
        });



       

        function remove_row_from_table(btn){
            var row_id = btn.id;
            $("#table_products_calc tr").each(function() {
                if ($(this).find('td').eq(1).text() == row_id){
                    var tr = $(this).closest("tr").remove().clone();
                };

                });
        };

        $('#table_search_results a').popover();


</script>

</html>